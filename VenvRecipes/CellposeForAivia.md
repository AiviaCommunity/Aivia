
Installation
------------
1. Download the Cellpose virtual environment ZIP file "Cellpose_virtualEnvironment.zip" from dropbox
   https://www.dropbox.com/s/0dczdliehhqj0wr/Cellpose_virtualEnvironment.zip?dl=1
2. Unzip "Cellpose_virtualEnvironment.zip" to a local folder
3. The Cellpose python recipe for Aivia is "\Cellpose_venv\Cellpose_Aivia.py"


Execution
---------
1. Load Cellpose python recipe "Cellpose_Aivia.py" onto Aivia
   - "Cellpose_Aivia.py" is stored under the top folder "\Cellpose_venv"
   - Load the recipe by using "File>Open" or drag-and-drop
2. Load target image onto Aivia
3. In Aivia analysis tools, adjust input, output, and processing parameters
4. Click on "Start" button and wait for the result


Cellpose Information
--------------------
This Aivia python recipe applies the Cellpose deep learning model to generate segmentation for cells/nucleus in 2D or 3D images.

Online information about Cellpose are listed below:

* Cellpose Website: http://www.cellpose.org/
* Cellpose GitHub: https://github.com/MouseLand/cellpose
* Cellpose documentation: http://www.cellpose.org/static/docs/index.html
* Cellpsoe paper: https://www.biorxiv.org/content/10.1101/2020.02.02.931238v1

There are a few important parameters for running Cellpose:

* Model: 
  * The user chooses whether to use the cytoplasm or nuclei model
* Diameter: 
  * The user provides an approximation of object size
    	

Requirements
------------
Cellpose_venv - the Cellpose python virtual environment in a folder that contains all required python packages to run the Cellpose.


Parameters
----------
* Input Image : Aivia channel
  * Input channel to segment.

* Diameter (px) : double
  * Approximate size of the structures you wish to segment (in pixels).

* Model Type (0=cyto, 1=nuc) l : int (bool)
  * Boolean to determine which Cellpose model you wish to run.
    * 0 : Choose the cytoplasm model (segment the whole cell).
    * 1 : Choose the nuclei model


Returns
-------
* Mask : Aivia channel
  * The labeled segmentation mask generated by applying the Cellpose model.
* Confidence Map : Aivia channel
  * The XY flow (for 2D) or Z flow (for 3D) generated by applying the Cellpose model. It represents the confidence that each voxel belongs to the segmentation mask.
