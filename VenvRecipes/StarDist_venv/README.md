# StarDist For Aivia

## StarDist Information

This Aivia python recipe applies the StraDist 2D or 3D deep learning model to generate segmentation for convex shape objects in 2D or 3D images.

- StarDist GitHub: [https://github.com/mpicbg-csbd/stardist](https://github.com/mpicbg-csbd/stardist)

The source of the pre-trained 2D and 3D StarDist Models are listed below:

1. 2D_demo model: [https://github.com/mpicbg-csbd/stardist/tree/master/models/examples/2D_demo](https://github.com/mpicbg-csbd/stardist/tree/master/models/examples/2D_demo)
2. 2D_dsb_2018: [https://github.com/mpicbg-csbd/stardist/tree/master/models/paper/2D_dsb2018](https://github.com/mpicbg-csbd/stardist/tree/master/models/paper/2D_dsb2018)
3. 2D_fluor_nuc: [https://drive.switch.ch/index.php/s/oCGZJaM949hMzjJ](https://drive.switch.ch/index.php/s/oCGZJaM949hMzjJ)
   - Please also check: [https://github.com/mpicbg-csbd/stardist/issues/46](https://github.com/mpicbg-csbd/stardist/issues/46)
4. 3D_demo model: [https://github.com/mpicbg-csbd/stardist/tree/master/models/examples/3D_demo](https://github.com/mpicbg-csbd/stardist/tree/master/models/examples/3D_demo)

## Installation

1. Download the whole `StarDist_venv` folder. Since GitHub does not support subfolder download, please click the following [link](https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/AiviaCommunity/PythonForAivia/tree/master/VenvRecipes/StarDist_venv) to download the folder. The link was generated from DownGit, an open source website for create GitHub repo subfolder download link.

2. Unzip the the downloaded folder `StarDist_venv`. The tree structure of the folder is as follow

```bash=
  StarDist_venv
  ├───StarDist_Aivia.py
  ├───requirements.txt
  ├───README.md
  └───Data
      ├───2D_demo
      ├───2D_dsb2018
      ├───2D_fluor_nuc
      ├───3D_demo
      └───Cellpose_venv.py
```

## Execution

1. Load `StarDist_Aivia.py` onto Aivia by "File>Open" or drag-and-drop

2. Load a target image onto Aivia

3. In Aivia analysis tools, adjust input, output, and processing parameters.

4. Click on "Start" button and wait for the result
    1. Please make sure that you have the Internet connection and wait longer for the first execution. When you run the recipe for the first time, the required virtual environment, `env`, will be created under `StarDist_venv`. Python packages used by StarDist will be downloaded and installed in the enironment.

## Requirements

- Vuitual Environment for StarDist - the required virtual environment will be created automatically when you run StarDist_Aivia.py for the first time. All required python packages will be installed in this virtual environment. You can check the `requirements.txt` to see what packages will be installed.

- Python 3.6+ - comes with Aivia

## Parameters

- Deep Learning Model : acmodel
  - You can select an Aivia's built-in acmodel here for preprocessing. Please leave it as "None" if you only want to use StarDist.

- Input Image : Aivia channel
  - Input channel to segment.

- Percentile Normalization High (0.0-100.0) : double
  - The percentile to be normalized to 1.

- Percentile Normalization Low (0.0-100.0) : double
  - The percentile to be normalized to 0.

- NMS Threshold (0.0-1.0) : double
  - Non maximum suppression threshold. A higher NMS threshold allows segmented objects to overlap substantially. A lower NMS threshold suppresses the object with lower confidence.

- Probability Threshold (0.0-1.0) : double
  - If an object's confidence is lower than this threshold, it will be removed.

- Model(0:demo,1:fluor, 2:DSB,3:3D) : int
  - To determine which pre-trained StarDist model you wish to run.
    - 0 : 2D_demo
    - 1 : 2D_fluor_nuc
    - 2 : 2D_DSB
    - 3 : 3D_demo

- Output(0:Lb,1:Msk) : int
  - To set the output type for the segmentation mask.
    - 0 : labeled segmentation mask
    - 1 : binary segmentation mask

## Returns

- Aivia channel
  - The labeled or binary segmentation mask generated by applying the StarDist model.

## Archived Version

For tracking only, please follow the Installation section to use the latest version of StarDist_venv.

**Important:** The following archived versions of StarDist_venv contain a pre-created virtual environment which may not work on your system.

[Archived version](https://www.dropbox.com/s/482p8iz5dt77oo8/StarDist_virtualEnvironment.zip?dl=1) with pre-created venv.
